<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>è£œåŠ©å“¡é‡é‡è¨ˆç®—ã‚²ãƒ¼ãƒ ï¼ˆè¨˜éŒ²ãƒ¢ãƒ¼ãƒ‰ï¼‰</title>
<style>
body { font-family: 'Segoe UI'; text-align:center; background:#c93232; color:#fff; margin:0; padding:0; }
h1 { font-size: clamp(1.2rem,4vw,2rem); margin-top:10px; }
h2 { font-size: clamp(1rem,3.5vw,1.5rem); margin:5px; color:#FFD700; }
button { background:#28a745; color:#fff; border:none; padding:12px 24px; border-radius:10px; cursor:pointer; font-size:clamp(1rem,3vw,1.2rem); margin:10px; }
button:disabled { background:#555; cursor:not-allowed; }
button:hover:not(:disabled) { background:#218838; }
.plates,.selected-area{display:flex;justify-content:center;gap:10px;flex-wrap:wrap;margin-inline:auto;max-width:600px;}
.plate,.selected-plate{border-radius:50%;width:clamp(60px,18vw,80px);height:clamp(60px,18vw,80px);display:flex;align-items:center;justify-content:center;cursor:pointer;font-weight:bold;transition:0.2s;user-select:none;flex-direction:column;}
.selected-plate{width:clamp(50px,15vw,70px);height:clamp(50px,15vw,70px);}
#bar,#target,#result,#progress,#timer{font-size:clamp(1rem,3.5vw,1.3rem);margin:5px;}
#scoreDisplay{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:#333;padding:30px;border-radius:20px;font-size:clamp(1rem,4vw,1.8rem);text-align:center;z-index:1000;}
#progress{position:fixed;top:10px;left:10px;}
#practiceBtn{position:fixed;bottom:10px;right:10px;}
#setumeiBtn{position:fixed;bottom:10px;left:10px;padding:5px;font-size:clamp(1rem,3vw,1.2rem);border-radius:10px;}
#rankingBtn{position:fixed;bottom:10px;left:130px;padding:5px;font-size:clamp(1rem,3vw,1.2rem);border-radius:10px;}
#timer{color:#ff5555;}
</style>
</head>
<body>

<h1>ğŸ‹ï¸â€â™‚ï¸ è¨˜éŒ²ãƒ¢ãƒ¼ãƒ‰</h1>
<h2 id="recordModeLabel"></h2>
<div id="progress">0 / 5</div>
<div id="timer"></div>
<h2 id="target"></h2>
<div class="plates" id="plates"></div>
<p id="bar">ç¾åœ¨ã®åˆè¨ˆ: 0kg</p>
<p id="result"></p>
<h3>ä½¿ç”¨ãƒ—ãƒ¬ãƒ¼ãƒˆ:</h3>
<div class="selected-area" id="selectedArea"></div>
<button id="nextBtn" disabled>æ¬¡ã¸</button>
<button id="practiceBtn" onclick="location.href='index.html'">ç·´ç¿’ãƒ¢ãƒ¼ãƒ‰</button>
<button id="setumeiBtn" onclick="location.href='setumei.html'">èª¬æ˜ãƒ¢ãƒ¼ãƒ‰</button>
<button id="rankingBtn" onclick="location.href='ranking.html'">ãƒ©ãƒ³ã‚­ãƒ³ã‚°</button>

<script>
// â˜… åŠ¹æœéŸ³è¨­å®šï¼ˆãƒ•ã‚¡ã‚¤ãƒ«ã¯å¾Œã§è¿½åŠ ï¼‰
function playSE(p){
    const sounds = {
        25:"20.mp3", 20:"20.mp3", 15:"15.mp3", 10:"10.mp3", 5:"5.mp3",
        "2.5_black":"2_5.mp3", "2.5_silver":"2_5_color.mp3", 1.25:"1_25.mp3",
        remove:"remove.mp3", correct:"correct.mp3", miss:"miss.mp3"
    };
    let key = p;
    if(typeof p==="object"){
        if(p.weight===2.5 && p.color==="silver") key="2.5_silver";
        else if(p.weight===2.5) key="2.5_black";
        else key=p.weight;
    }
    const file = sounds[key];
    if(!file) return;
    const audio = new Audio(file);
    audio.volume=0.6;
    audio.play().catch(()=>{});
}

// ãƒ¢ãƒ¼ãƒ‰é¸æŠ
const mode = prompt("ãƒ¢ãƒ¼ãƒ‰ã‚’é¸æŠ\n1: åˆå¿ƒè€… 25~120kg\n2: ä¸­ç´šè€… 120~210kg\n3: ãƒ•ãƒ«ã‚®ã‚¢å‹¢ 210~350kg\n4: ç¥ï¼ˆ25~350kg/é‡é‡éè¡¨ç¤ºï¼‰");
let min=25,max=120,hideWeight=false;
if(mode=="2"){min=120; max=210;}
if(mode=="3"){min=210; max=350;}
if(mode=="4"){min=25; max=350; hideWeight=true;}
document.getElementById('recordModeLabel').textContent=
    (mode=="1")?"åˆå¿ƒè€…":(mode=="2")?"ä¸­ç´šè€…":(mode=="3")?"ãƒ•ãƒ«ã‚®ã‚¢å‹¢":"ç¥ãƒ¢ãƒ¼ãƒ‰";

const plateData=[
  {weight:25,color:'red'},
  {weight:20,color:'blue'},
  {weight:15,color:'yellow',textColor:'black'},
  {weight:10,color:'green'},
  {weight:5,color:'white',textColor:'black'},
  {weight:2.5,color:'black'},
  {weight:2.5,color:'silver',label:'2.5(ã‚«ãƒ©ãƒ¼)'},
  {weight:1.25,color:'#7fae7f'}
];

let selected=[],targetWeight=0,recordCount=0,records=[],startTime=0,timerInt;

function updateProgress(){ document.getElementById('progress').textContent=`${recordCount} / 5`; }

// ã‚²ãƒ¼ãƒ é–‹å§‹
function startGame(){
  clearInterval(timerInt);
  const possible=[];
  for(let w=min; w<=max; w+=2.5) possible.push(w);
  targetWeight=possible[Math.floor(Math.random()*possible.length)];

  selected=[];
  document.getElementById('target').textContent=`ç›®æ¨™é‡é‡: ${targetWeight} kg`;
  document.getElementById('result').textContent='';
  document.getElementById('selectedArea').innerHTML='';
  document.getElementById('nextBtn').disabled=true;

  renderPlates();
  updateTotal();
  startTimer();
  startTime=Date.now();
}

// ã‚¿ã‚¤ãƒãƒ¼
function startTimer(){
  let remain=20;
  document.getElementById('timer').textContent=`æ®‹ã‚Šæ™‚é–“: ${remain}ç§’`;
  timerInt=setInterval(()=>{
    remain--;
    document.getElementById('timer').textContent=`æ®‹ã‚Šæ™‚é–“: ${remain}ç§’`;
    if(remain<=0){
      clearInterval(timerInt);
      document.getElementById('result').textContent="âŒ ã‚¿ã‚¤ãƒ ã‚ªãƒ¼ãƒãƒ¼";
      playSE("miss");
      document.getElementById('nextBtn').disabled=false;
    }
  },1000);
}

// ãƒ—ãƒ¬ãƒ¼ãƒˆæç”»
function renderPlates(){
  const div=document.getElementById('plates');
  div.innerHTML='';
  plateData.forEach(p=>{
    const el=document.createElement('div');
    el.className='plate';
    el.textContent=p.label||p.weight;
    el.style.background=p.color;
    el.style.color=p.textColor||'#fff';
    el.onclick=()=>{
      if(targetWeight>=75 && p.color=="blue") return;
      addPlate(p);
    };
    div.appendChild(el);
  });
}

// ãƒ—ãƒ¬ãƒ¼ãƒˆè¿½åŠ 
function addPlate(p){
  selected.push(p);
  playSE(p); // ç½®ãæ™‚
  updateTotal();
  renderSelected();
}

// é¸æŠãƒ—ãƒ¬ãƒ¼ãƒˆæç”»
function renderSelected(){
  const area=document.getElementById('selectedArea');
  area.innerHTML='';
  selected.forEach((p,i)=>{
    const el=document.createElement('div');
    el.className='selected-plate';
    el.style.background=p.color;
    el.style.color=p.textColor||'#fff';
    el.textContent=p.label||p.weight;
    el.onclick=()=>{
      selected.splice(i,1);
      playSE("remove"); // å¤–ã™æ™‚
      renderSelected();
      updateTotal();
    };
    area.appendChild(el);
  });
}

// åˆè¨ˆè¨ˆç®—ãƒ»æ­£èª¤åˆ¤å®š
function updateTotal(){
  const plateSum = selected.reduce((a,b)=>a+b.weight,0);
  const total = 20 + plateSum*2;
  document.getElementById('bar').textContent=hideWeight?"ç¾åœ¨ã®åˆè¨ˆ: ???":`ç¾åœ¨ã®åˆè¨ˆ: ${total}kg`;

  const last=selected[selected.length-1];
  const lastIsColor=last && last.color==='silver';
  const colorInMiddle=selected.slice(0,-1).some(p=>p.color==='silver');
  let color125=false;
  selected.forEach((p,i)=>{
    if(p.color==='silver' && i<selected.length-1 && selected[i+1].weight===1.25) color125=true;
  });

  let res="",correct=false;

  if(total===targetWeight && lastIsColor && !colorInMiddle && !color125){
    res="âœ… æ­£è§£ï¼";
    correct=true;
    playSE("correct");
    clearInterval(timerInt);
  } else if(total===targetWeight && !lastIsColor){ res="âš ï¸ æœ€å¾Œã«ã‚«ãƒ©ãƒ¼å¿…è¦"; }
  else if(colorInMiddle){ res="âš ï¸ ã‚«ãƒ©ãƒ¼ã¯æœ€å¾Œã ã‘"; }
  else if(color125){ res="âš ï¸ ã‚«ãƒ©ãƒ¼ã®å¾Œã«1.25kgç¦æ­¢"; }
  else if(total>targetWeight){ res="âŒ ã‚ªãƒ¼ãƒãƒ¼"; playSE("miss"); }

  document.getElementById('result').textContent=res;
  document.getElementById('nextBtn').disabled=!correct;
}

// æ¬¡ã¸
document.getElementById('nextBtn').onclick=()=>{
  clearInterval(timerInt);
  const elapsed=(Date.now()-startTime)/1000;
  const isCorrect=document.getElementById('result').textContent.includes('âœ…');
  records.push({correct:isCorrect,time:elapsed});
  recordCount++;
  updateProgress();
  if(recordCount>=5) showRecordResult();
  else startGame();
};

// çµæœè¡¨ç¤º
function showRecordResult(){
  const correctCount=records.filter(r=>r.correct).length;
  const times=records.filter(r=>r.correct).map(r=>r.time.toFixed(2));
  const correctRate=((correctCount/5)*100).toFixed(1);
  const avg=(times.reduce((a,b)=>a+parseFloat(b),0)/times.length||0).toFixed(2);

  let div=document.createElement('div'); div.id='scoreDisplay';
  div.innerHTML=`
    <h2>ğŸ“Š è¨˜éŒ²çµ‚äº†</h2>
    <p>æ­£è§£å›æ•°: ${correctCount}/5</p>
    <p>ã‹ã‹ã£ãŸæ™‚é–“(ç§’): ${times.join(', ')}</p>
    <p>æ­£è§£ç‡: ${correctRate}%</p>
    <p>å¹³å‡ã‚¹ãƒ”ãƒ¼ãƒ‰: ${avg} ç§’</p>
    <button id="scoreCloseBtn">é–‰ã˜ã‚‹</button>
  `;
  document.body.appendChild(div);
  document.getElementById('scoreCloseBtn').onclick=()=>{
    div.remove(); records=[]; recordCount=0; updateProgress(); startGame();
  }
}

startGame();
</script>
</body>
</html>
